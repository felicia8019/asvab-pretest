<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ASVAB Pre-Test (Verbal & Math)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#121821;
      --muted-border:#233145;
      --primary:#2563eb;
      --primary-hover:#1d4ed8;
      --choice-bg:#1f2937;
      --correct:#14532d;
      --wrong:#7f1d1d;
      --text:#e9eef5;
      --meter-start:#2bb673;
      --meter-end:#3b82f6;
    }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
    .wrap { max-width: 900px; margin: 2rem auto; padding: 1rem; }
    .card { background: var(--card); border-radius: 16px; padding: 24px; margin-bottom: 1rem; }
    h1, h2, h3 { margin-top: 0; }
    button { background: var(--primary); color: #fff; border: none; padding: 10px 18px; border-radius: 10px; cursor: pointer; }
    button:hover { background: var(--primary-hover); }
    .choice { display: block; margin: 0.5rem 0; padding: 0.5rem; background: var(--choice-bg); border-radius: 8px; cursor: pointer; border: 1px solid transparent; color: var(--text); text-align: left; }
    .choice:focus { outline: 2px solid #3b82f6; outline-offset: 2px; }
    .choice.selected { border-color: #3b82f6; }
    .choice.correct { background: var(--correct); }
    .choice.wrong { background: var(--wrong); }
    .hidden { display: none; }
    .meter { height: 10px; background: #0f1520; border-radius: 8px; margin-bottom: 1rem; }
    .meter > i { display: block; height: 100%; background: linear-gradient(90deg, var(--meter-start), var(--meter-end)); width: 0%; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid var(--muted-border); padding: 8px; text-align: left; }

    .stats { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 12px; }
    @media (max-width: 760px){ .stats{ grid-template-columns: 1fr; } }
    .tile { background:#0f1520; border:1px solid var(--muted-border); border-radius:12px; padding:12px; }
    .meter-sm{ height:8px; background:#0b1220; border-radius:6px; }
    .meter-sm>i{ display:block; height:100%; background:linear-gradient(90deg,var(--meter-start),var(--meter-end)); width:0%; }
    canvas{ background:#0f1520; border:1px solid var(--muted-border); border-radius:12px; width:100%; max-width:100%; height:280px; display:block; }

    /* tooltip */
    .tip{ display:inline-flex; align-items:center; gap:6px; margin-left:6px; position:relative; }
    .tip i{ display:inline-block; width:18px; height:18px; border-radius:50%; background:#1f2937; border:1px solid #334155; text-align:center; line-height:18px; font-style:normal; font-weight:700; font-size:0.85rem; color:var(--text); }
    .tip .bubble{ position:absolute; left:0; top:130%; width:min(540px,90vw); background:#0b1220; border:1px solid var(--muted-border); color:var(--text); padding:10px; border-radius:10px; display:none; z-index:5; }
    .tip:hover .bubble{ display:block; }
  </style>
</head>
<body>
  <!-- ACCESS OVERLAY: blocks app until valid code is entered -->
  <div id="accessOverlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.85);z-index:9999;">
    <div style="background:#0f1520;border:1px solid #233145;padding:20px;border-radius:12px;max-width:420px;width:92%;text-align:left;color:#e9eef5;box-shadow:0 10px 30px rgba(0,0,0,.35);">
      <h3 style="margin:0 0 8px">Enter Recruiter Access Code</h3>
      <p style="margin:0 0 12px;color:#9fb3c8;font-size:0.95rem">Ask your recruiter for a temporary code.</p>
      <input id="accessInput" type="password" placeholder="Access code" style="width:100%;padding:10px;border-radius:8px;border:1px solid #233145;background:#0b1220;color:#e9eef5" />
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
        <button id="accessBtn" style="padding:8px 12px;border-radius:8px;border:none;background:#2563eb;color:white;cursor:pointer">Submit</button>
      </div>
      <p id="accessMsg" style="color:#f59e0b;margin-top:10px;display:none"></p>
    </div>
  </div>

  <div class="wrap">
    <div id="start" class="card">
      <h1>ASVAB Pre-Test</h1>
      <p>This practice test covers four core ASVAB areas: <b>Word Knowledge</b>, <b>Paragraph Comprehension</b>, <b>Mathematics Knowledge</b>, and <b>Arithmetic Reasoning</b>. Select your settings below.</p>
      <label>Mode:</label>
      <select id="modeSel">
        <option value="balanced-40" selected>Balanced – 40 questions (10 per section)</option>
        <option value="quick-32">Quick – 32 questions (8 per section)</option>
      </select>
      <div style="margin-top:1rem;">
        <label><input type="checkbox" id="instantFeedback"> Show feedback after each question</label>
      </div>
      <button id="btnStart">Start</button>
    </div>

    <div id="quiz" class="card hidden">
      <div class="meter"><i id="progressBar"></i></div>
      <h2 id="qText"></h2>
      <div id="choiceList"></div>
      <button id="btnPrev">Back</button>
      <button id="btnNext">Next</button>
      <p id="feedback" aria-live="polite"></p>
    </div>

    <div id="summary" class="card hidden">
      <h2>Results</h2>
      <p id="scoreLine"></p>
      <div id="afqtBox" class="tile" style="margin:12px 0;">
        <b>Practice AFQT Summary</b>
        <span class="tip" aria-label="What is AFQT?">
          <i>i</i>
          <span class="bubble">
            <b>AFQT (Armed Forces Qualification Test)</b> is an official percentile based on scaled scores from four subtests: Word Knowledge (WK), Paragraph Comprehension (PC) → combined into VE, plus MK and AR.
            This app shows an <em>unofficial practice index</em> to gauge readiness:<br>
            <code>Practice AFQT Index = (2 × VE + AR + MK) / 4</code>, where <code>VE = average(WK%, PC%)</code>.
          </span>
        </span>
        <div id="afqtLine" style="margin:6px 0 8px;"></div>
        <div class="meter-sm"><i id="afqtMeter" style="width:0%"></i></div>
        <small class="muted">Note: This is an <em>unofficial practice index</em> based on WK/PC (VE), AR, and MK performance. Real AFQT is computed from scaled scores and official norms.</small>
      </div>

      <h3>Section Scores</h3>
      <div id="sectionStats" class="stats" aria-live="polite"></div>
      <div style="margin-top:12px;">
        <canvas id="barChart" width="820" height="280" aria-label="Score by section bar chart"></canvas>
      </div>
      <h3 style="margin-top:16px;">Review</h3>
      <table><thead><tr><th>#</th><th>Domain</th><th>Question</th><th>Your Answer</th><th>Correct</th></tr></thead><tbody id="review"></tbody></table>
      <button id="btnRetry">Try Again</button>
    </div>
  </div>

<script>
// ====== QUESTION BANK: 10 per section (WK, PC, MK, AR) ======
const BANK = {
  WK:[
    {d:'WK',q:'Select the best synonym for OBLIVIOUS.',c:['Unaware','Careful','Alert','Friendly'],a:0},
    {d:'WK',q:'Select the word most similar to PERPLEXED.',c:['Confused','Certain','Calm','Sure'],a:0},
    {d:'WK',q:'Select the antonym for VIGOROUS.',c:['Energetic','Lively','Weak','Active'],a:2},
    {d:'WK',q:'Choose the synonym for CONCEAL.',c:['Reveal','Hide','Show','Expose'],a:1},
    {d:'WK',q:'Select the best synonym for HASTY.',c:['Slow','Rushed','Calm','Lazy'],a:1},
    {d:'WK',q:'Choose the antonym for FRAGILE.',c:['Delicate','Breakable','Strong','Weak'],a:2},
    {d:'WK',q:'Select the synonym for ABUNDANT.',c:['Scarce','Plentiful','Empty','Small'],a:1},
    {d:'WK',q:'Select the best synonym for BRIEF.',c:['Lengthy','Short','Detailed','Drawn-out'],a:1},
    {d:'WK',q:'Choose the synonym for RELUCTANT.',c:['Eager','Willing','Hesitant','Happy'],a:2},
    {d:'WK',q:'Select the best synonym for IMPEDE.',c:['Help','Block','Promote','Encourage'],a:1}
  ],
  PC:[
    {d:'PC',q:'A passage says: “Proper hydration improves focus.” The main idea is that:',c:['Water causes illness.','Dehydration reduces concentration.','Hydration reduces intelligence.','Focus is unaffected.'],a:1},
    {d:'PC',q:'A passage describes how a lever helps lift heavy objects. The main idea is about:',c:['Musical instruments','Mechanical advantage','Human strength','Gravity'],a:1},
    {d:'PC',q:'A passage states: “Farmers rotate crops yearly to restore soil nutrients.” This means:',c:['Crop rotation harms soil.','Changing crops helps maintain fertility.','Farmers waste land.','Rotating crops is unnecessary.'],a:1},
    {d:'PC',q:'If a paragraph explains the water cycle, it is mainly about:',c:['Weather and evaporation','Space travel','Food chains','Wind direction'],a:0},
    {d:'PC',q:'A paragraph explains that regular study improves memory. The best conclusion is:',c:['Study has no effect.','Practice strengthens recall.','Only rest improves memory.','Memory cannot improve.'],a:1},
    {d:'PC',q:'If a passage details soldiers’ training improving teamwork, the main idea is:',c:['Training builds cooperation.','Teamwork harms progress.','Individual work is better.','Soldiers train alone.'],a:0},
    {d:'PC',q:'A paragraph about nutrition focusing on protein intake is mainly about:',c:['Carbohydrates','Exercise','Protein and diet','Water intake'],a:2},
    {d:'PC',q:'A passage states: “Good sleep enhances cognitive performance.” The conclusion is:',c:['Sleep reduces performance.','Rest has no benefit.','Sleep helps the brain work better.','Cognitive ability declines with sleep.'],a:2},
    {d:'PC',q:'If a paragraph discusses recycling benefits, its purpose is to:',c:['Discourage recycling.','Explain advantages of recycling.','Describe littering.','Promote deforestation.'],a:1},
    {d:'PC',q:'A passage about soldiers’ discipline implies that:',c:['Rules reduce order.','Discipline supports effectiveness.','Freedom is harmful.','Training is not required.'],a:1}
  ],
  MK:[
    {d:'MK',q:'Simplify: 2(x + 3) + 4',c:['2x + 7','2x + 6','2x + 10','x + 5'],a:0},
    {d:'MK',q:'Solve: 5x = 25',c:['10','0','5','1'],a:2},
    {d:'MK',q:'If y = 2x + 3, find y when x = 4.',c:['7','10','11','8'],a:2},
    {d:'MK',q:'Find the perimeter of a rectangle 8 by 3.',c:['24','11','16','22'],a:3},
    {d:'MK',q:'What is the area of a triangle with base 10 and height 4?',c:['40','14','20','24'],a:2},
    {d:'MK',q:'Simplify: 3(2x − 4) + 2(x + 5)',c:['8x + 2','5x − 2','5x + 2','8x − 2'],a:3},
    {d:'MK',q:'If a = 4 and b = 3, what is 2a + b?',c:['7','10','11','14'],a:2},
    {d:'MK',q:'Find x: x/3 = 12',c:['3','6','15','36'],a:3},
    {d:'MK',q:'What is 9² − 7²?',c:['16','32','36','44'],a:2},
    {d:'MK',q:'Simplify: (5x + 10) / 5',c:['x + 2','x + 10','x + 5','2x + 10'],a:0}
  ],
  AR:[
    {d:'AR',q:'If 3 pencils cost $1.50, how much for 10?',c:['$4.50','$5.00','$3.00','$6.00'],a:0},
    {d:'AR',q:'A car travels 180 miles in 3 hours. Average speed?',c:['50 mph','55 mph','60 mph','65 mph'],a:2},
    {d:'AR',q:'A jacket costs $40 after a 20% discount. Original price?',c:['$48','$50','$60','$45'],a:1},
    {d:'AR',q:'A recipe for 4 people needs 2 cups of rice. How many cups for 10 people?',c:['4','5','6','8'],a:1},
    {d:'AR',q:'If you earn $12/hour for 8 hours a day, weekly pay (5 days)?',c:['$420','$460','$480','$500'],a:2},
    {d:'AR',q:'A machine makes 120 parts in 4 hours. How many in 10 hours?',c:['250','280','300','320'],a:2},
    {d:'AR',q:'A train moves 90 miles in 1.5 hours. Its average speed is:',c:['45 mph','50 mph','55 mph','60 mph'],a:3},
    {d:'AR',q:'A shirt is $30 with 15% off. Sale price?',c:['$25.50','$27','$28.50','$26'],a:0},
    {d:'AR',q:'A worker earns $18/hr and gets a 10% raise. New pay?',c:['$19.80','$20','$18.80','$22'],a:0},
    {d:'AR',q:'If 5 books cost $45, what’s the price per book?',c:['$7','$8','$9','$10'],a:2}
  ]
};

let quiz=[], answers=[], i=0, instant=false;
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
function pickN(arr,n){ const a=[...arr]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a.slice(0,n); }

function start(){
  const mode = $('#modeSel').value; // 'balanced-40' or 'quick-32'
  const per = mode==='quick-32' ? 8 : 10;
  const wk = pickN(BANK.WK, per);
  const pc = pickN(BANK.PC, per);
  const mk = pickN(BANK.MK, per);
  const ar = pickN(BANK.AR, per);
  quiz=[...wk,...pc,...mk,...ar].sort(()=>Math.random()-0.5);
  answers=Array(quiz.length).fill(null); i=0; instant=$('#instantFeedback').checked;
  $('#start').classList.add('hidden'); $('#quiz').classList.remove('hidden');
  render();
}

function render(){
  const q=quiz[i];
  $('#qText').textContent=`(${q.d}) ${q.q}`;
  const list=$('#choiceList'); list.innerHTML='';
  q.c.forEach((ch,idx)=>{
    // use a button so it's keyboard accessible and semantic
    const btn=document.createElement('button');
    btn.type='button';
    btn.className='choice';
    btn.setAttribute('data-choice', idx);
    btn.setAttribute('aria-pressed', String(answers[i]===idx));
    btn.textContent = ch;
    btn.addEventListener('click', ()=>select(idx));
    if(answers[i]===idx) btn.classList.add('selected');
    list.appendChild(btn);
  });
  // progress reflects position (1..N)
  $('#progressBar').style.width = (((i+1)/quiz.length)*100) + '%';
  $('#feedback').textContent='';
}

function select(idx){
  answers[i]=idx;
  // reflect selection UI
  const listItems = $$('#choiceList .choice');
  listItems.forEach((el)=>{
    const j = Number(el.getAttribute('data-choice'));
    el.classList.remove('correct','wrong','selected');
    el.setAttribute('aria-pressed', 'false');
    if(j === idx) { el.classList.add('selected'); el.setAttribute('aria-pressed','true'); }
  });

  if(instant){
    const q = quiz[i];
    const list = $$('#choiceList .choice');
    list.forEach((el)=>{
      const j = Number(el.getAttribute('data-choice'));
      el.classList.remove('correct','wrong');
      if(j === q.a) el.classList.add('correct');
      else if(j === idx) el.classList.add('wrong');
    });
    $('#feedback').textContent = idx === q.a ? 'Correct!' : `Incorrect. Correct: ${q.c[q.a]}`;
  }
}

function next(){ if(i<quiz.length-1){ i++; render(); } else finish(); }
function prev(){ if(i>0){ i--; render(); } }

function finish(){
  // ensure progress shows complete
  $('#progressBar').style.width = '100%';

  let correct=0; const tbody=$('#review'); tbody.innerHTML='';
  const byDom={WK:{t:0,c:0},PC:{t:0,c:0},MK:{t:0,c:0},AR:{t:0,c:0}};
  quiz.forEach((q,k)=>{
    const a = answers[k];
    const ok = a === q.a;
    if(ok) correct++;
    byDom[q.d].t++; if(ok) byDom[q.d].c++;

    // create row without innerHTML to avoid XSS (textContent)
    const tr = document.createElement('tr');
    const tdIdx = document.createElement('td'); tdIdx.textContent = String(k+1);
    const tdDom = document.createElement('td'); tdDom.textContent = q.d;
    const tdQ = document.createElement('td'); tdQ.textContent = q.q;
    const tdYour = document.createElement('td'); tdYour.textContent = (a != null) ? q.c[a] : '';
    const tdCorrect = document.createElement('td'); tdCorrect.textContent = q.c[q.a];

    tr.appendChild(tdIdx);
    tr.appendChild(tdDom);
    tr.appendChild(tdQ);
    tr.appendChild(tdYour);
    tr.appendChild(tdCorrect);
    tbody.appendChild(tr);
  });

  const pct = Math.round(correct/quiz.length*100);
  $('#scoreLine').textContent=`You got ${correct}/${quiz.length} correct (${pct}%).`;

  // Section tiles
  const statsWrap=$('#sectionStats'); statsWrap.innerHTML='';
  const labels={WK:'Word Knowledge',PC:'Paragraph Comprehension',MK:'Mathematics Knowledge',AR:'Arithmetic Reasoning'};
  const percents={};
  Object.keys(byDom).forEach(k=>{
    const s=byDom[k]; const p=s.t?Math.round(100*s.c/s.t):0; percents[k]=p;
    const div=document.createElement('div'); div.className='tile';
    div.innerHTML=`<b>${labels[k]} (${k})</b><br><small>${s.c}/${s.t} correct</small>
      <div class="meter-sm" style="margin-top:6px;"><i style="width:${p}%"></i></div>`;
    statsWrap.appendChild(div);
  });

  // Practice AFQT index (unofficial): AFQT_index = (2*VE + AR + MK)/4, where VE = (WK% + PC%)/2
  const VE = ((percents.WK||0) + (percents.PC||0)) / 2;
  const AFQT_index = Math.round((2*VE + (percents.AR||0) + (percents.MK||0)) / 4);
  let band;
  if (AFQT_index >= 75) band = 'Excellent (Category I–IIA range)';
  else if (AFQT_index >= 60) band = 'Strong (approx. Cat IIA–IIB)';
  else if (AFQT_index >= 45) band = 'Moderate (approx. Cat IIB–IIIA)';
  else if (AFQT_index >= 31) band = 'Developing (approx. Cat IIIA threshold)';
  else band = 'Needs Work (Below Cat IIIA)';
  $('#afqtLine').innerHTML = `Estimated practice AFQT index: <b>${AFQT_index}</b>% — <span>${band}</span>`;
  $('#afqtMeter').style.width = AFQT_index + '%';

  // Draw bar chart
  drawBarChart(byDom);

  $('#quiz').classList.add('hidden'); $('#summary').classList.remove('hidden');
}

function drawBarChart(byDom){
  const canvas = $('#barChart');
  const ctx = canvas.getContext('2d');

  // handle high-DPI / responsive canvas
  const ratio = window.devicePixelRatio || 1;
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  canvas.width = Math.round(w * ratio);
  canvas.height = Math.round(h * ratio);
  ctx.setTransform(ratio, 0, 0, ratio, 0, 0);

  // clear
  ctx.clearRect(0,0,w,h);
  const keys=['WK','PC','MK','AR'];
  const names={WK:'WK',PC:'PC',MK:'MK',AR:'AR'};
  const vals=keys.map(k=> byDom[k].t? (byDom[k].c/byDom[k].t)*100 : 0);
  const W=w, H=h, pad=40, gap=30, barW=(W-2*pad - gap*(keys.length-1))/keys.length;
  // axes
  ctx.fillStyle='#e9eef5'; ctx.font='14px system-ui';
  ctx.beginPath(); ctx.moveTo(pad, pad); ctx.lineTo(pad, H-pad); ctx.lineTo(W-pad, H-pad); ctx.strokeStyle='#233145'; ctx.lineWidth=2; ctx.stroke();
  // y ticks
  for(let y=0;y<=100;y+=20){
    const yy = H - pad - (y/100)*(H-2*pad);
    ctx.fillStyle='#9fb3c8'; ctx.fillText(y+'%', 6, yy+4);
    ctx.beginPath(); ctx.moveTo(pad, yy); ctx.lineTo(W-pad, yy); ctx.strokeStyle='rgba(35,49,69,0.6)'; ctx.lineWidth=1; ctx.stroke();
  }
  // bars
  keys.forEach((k,idx)=>{
    const p=vals[idx];
    const x=pad + idx*(barW+gap);
    const y=H - pad - (p/100)*(H-2*pad);
    const hBar=(p/100)*(H-2*pad);
    // gradient fill (blue-green)
    const g=ctx.createLinearGradient(0,y,0,H-pad);
    g.addColorStop(0,'#2bb673'); g.addColorStop(1,'#3b82f6');
    ctx.fillStyle=g; ctx.fillRect(x,y,barW,hBar);
    // label
    ctx.fillStyle='#e9eef5'; ctx.textAlign='center';
    ctx.fillText(names[k], x+barW/2, H-pad+18);
    ctx.fillText(Math.round(p)+'%', x+barW/2, y-6);
  });
}

// ===== ACCESS CODE (client-side hashed) =====
// IMPORTANT: Client-side hashed codes are easy to inspect and bypass.
// For production/secure gating, validate codes on the server or use signed short-lived tokens
// rather than storing hashes in front-end JS.
const ACCESS_ALLOWED_HASHES = [
  // Example: SHA-256('WEEK43-PRARNG')
  '15e2b0d3c33891ebb0f1ef609ec419420c20e320ce94c65fbc8c3312448eb225'
];
const ACCESS_EXPIRY = {
  // Optional: "15e2b0d3c33891ebb0f1ef609ec419420c20e320ce94c65fbc8c3312448eb225": "2025-10-27T00:00:00Z"
};
const overlay = document.getElementById('accessOverlay');
const accessInput = document.getElementById('accessInput');
const accessBtn = document.getElementById('accessBtn');
const accessMsg = document.getElementById('accessMsg');

async function sha256hex(str){
  const enc=new TextEncoder();
  const data=enc.encode(str);
  const buf=await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function isExpired(hash){
  if(!ACCESS_EXPIRY[hash]) return false;
  return Date.now() > Date.parse(ACCESS_EXPIRY[hash]);
}
function grantAccess(){ overlay.style.display='none'; sessionStorage.setItem('asvab_access_ok','1'); }

accessBtn?.addEventListener('click', async ()=>{
  const code=(accessInput?.value||'').trim();
  if(!code){ accessMsg.style.display='block'; accessMsg.style.color='#f59e0b'; accessMsg.textContent='Please enter a code.'; return; }
  accessBtn.disabled=true; accessMsg.style.display='none';
  try{
    const h=await sha256hex(code);
    if(ACCESS_ALLOWED_HASHES.includes(h)){ 
      if(isExpired(h)){ 
        accessMsg.style.display='block'; accessMsg.style.color='#ef4444'; accessMsg.textContent='This code has expired.'; accessBtn.disabled=false; return;
      }
      grantAccess();
    } else {
      accessMsg.style.display='block'; accessMsg.style.color='#ef4444'; accessMsg.textContent='Invalid code.'; accessBtn.disabled=false;
    }
  }catch(e){ accessMsg.style.display='block'; accessMsg.style.color='#ef4444'; accessMsg.textContent='Error validating code.'; accessBtn.disabled=false; }
});

window.addEventListener('load', ()=>{
  if(sessionStorage.getItem('asvab_access_ok')==='1') grantAccess();
});

// Buttons
document.getElementById('btnStart').onclick = start;
document.getElementById('btnNext').onclick = next;
document.getElementById('btnPrev').onclick = prev;
document.getElementById('btnRetry').onclick = ()=>{ location.reload(); };
</script>
</body>
</html>
